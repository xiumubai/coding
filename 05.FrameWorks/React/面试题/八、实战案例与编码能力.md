## 八、实战案例与编码能力

### 1. 请设计并实现一个具有拖拽功能的待办事项列表，包括添加、删除、标记完成和拖拽排序功能。

**问题解析**：这个问题考察候选人的实际编码能力和React组件设计能力，要求实现一个具有多种交互功能的待办事项应用。

**参考答案**：

以下是一个具有拖拽功能的待办事项列表的实现，使用React和react-beautiful-dnd库：

**安装依赖**：

```bash
npm install react-beautiful-dnd uuid
```

**实现代码**：

```jsx
import React, { useState } from 'react';
import { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';
import { v4 as uuidv4 } from 'uuid';
import './TodoApp.css';

function TodoApp() {
  const [todos, setTodos] = useState([
    { id: uuidv4(), text: '学习React基础', completed: true },
    { id: uuidv4(), text: '实现待办事项应用', completed: false },
    { id: uuidv4(), text: '添加拖拽功能', completed: false },
  ]);
  const [inputValue, setInputValue] = useState('');

  // 添加新待办事项
  const handleAddTodo = () => {
    if (inputValue.trim() !== '') {
      const newTodo = {
        id: uuidv4(),
        text: inputValue,
        completed: false,
      };
      setTodos([...todos, newTodo]);
      setInputValue('');
    }
  };

  // 处理输入变化
  const handleInputChange = (e) => {
    setInputValue(e.target.value);
  };

  // 处理按键事件（回车添加）
  const handleKeyDown = (e) => {
    if (e.key === 'Enter') {
      handleAddTodo();
    }
  };

  // 切换待办事项完成状态
  const toggleComplete = (id) => {
    setTodos(
      todos.map((todo) =>
        todo.id === id ? { ...todo, completed: !todo.completed } : todo
      )
    );
  };

  // 删除待办事项
  const deleteTodo = (id) => {
    setTodos(todos.filter((todo) => todo.id !== id));
  };

  // 处理拖拽结束事件
  const handleDragEnd = (result) => {
    // 如果没有目标或拖拽到列表外，不做任何操作
    if (!result.destination) return;

    // 创建todos的副本
    const items = Array.from(todos);
    // 移除拖拽的项
    const [reorderedItem] = items.splice(result.source.index, 1);
    // 在新位置插入拖拽的项
    items.splice(result.destination.index, 0, reorderedItem);

    // 更新状态
    setTodos(items);
  };

  return (
    <div className="todo-app">
      <h1>待办事项列表</h1>
      <div className="todo-input">
        <input
          type="text"
          value={inputValue}
          onChange={handleInputChange}
          onKeyDown={handleKeyDown}
          placeholder="添加新待办事项..."
        />
        <button onClick={handleAddTodo}>添加</button>
      </div>

      <DragDropContext onDragEnd={handleDragEnd}>
        <Droppable droppableId="todos">
          {(provided) => (
            <ul
              className="todo-list"
              {...provided.droppableProps}
              ref={provided.innerRef}
            >
              {todos.map((todo, index) => (
                <Draggable key={todo.id} draggableId={todo.id} index={index}>
                  {(provided, snapshot) => (
                    <li
                      ref={provided.innerRef}
                      {...provided.draggableProps}
                      {...provided.dragHandleProps}
                      className={`todo-item ${snapshot.isDragging ? 'dragging' : ''} ${todo.completed ? 'completed' : ''}`}
                    >
                      <div className="todo-content">
                        <input
                          type="checkbox"
                          checked={todo.completed}
                          onChange={() => toggleComplete(todo.id)}
                        />
                        <span className="todo-text">{todo.text}</span>
                      </div>
                      <button
                        className="delete-btn"
                        onClick={() => deleteTodo(todo.id)}
                      >
                        删除
                      </button>
                    </li>
                  )}
                </Draggable>
              ))}
              {provided.placeholder}
            </ul>
          )}
        </Droppable>
      </DragDropContext>

      <div className="todo-stats">
        <span>
          完成: {todos.filter((todo) => todo.completed).length} / {todos.length}
        </span>
      </div>
    </div>
  );
}

export default TodoApp;
```

**CSS样式**：

```css
/* TodoApp.css */
.todo-app {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
  font-family: Arial, sans-serif;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  background-color: #fff;
}

h1 {
  text-align: center;
  color: #333;
}

.todo-input {
  display: flex;
  margin-bottom: 20px;
}

.todo-input input {
  flex: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px 0 0 4px;
  font-size: 16px;
}

.todo-input button {
  padding: 10px 15px;
  background-color: #4caf50;
  color: white;
  border: none;
  border-radius: 0 4px 4px 0;
  cursor: pointer;
  font-size: 16px;
}

.todo-input button:hover {
  background-color: #45a049;
}

.todo-list {
  list-style-type: none;
  padding: 0;
  margin: 0;
}

.todo-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 15px;
  background-color: #f9f9f9;
  border: 1px solid #ddd;
  margin-bottom: 8px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.todo-item.dragging {
  background-color: #e0f7fa;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
}

.todo-item.completed {
  background-color: #e8f5e9;
  border-color: #c8e6c9;
}

.todo-item.completed .todo-text {
  text-decoration: line-through;
  color: #7cb342;
}

.todo-content {
  display: flex;
  align-items: center;
  flex: 1;
}

.todo-content input[type="checkbox"] {
  margin-right: 10px;
  cursor: pointer;
}

.todo-text {
  font-size: 16px;
  color: #333;
}

.delete-btn {
  padding: 5px 10px;
  background-color: #f44336;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.delete-btn:hover {
  background-color: #d32f2f;
}

.todo-stats {
  margin-top: 20px;
  text-align: right;
  color: #757575;
  font-size: 14px;
}
```

**代码解析**：

1. **状态管理**：
   - 使用`useState`管理待办事项列表和输入框的值
   - 每个待办事项包含id、text和completed属性

2. **基本功能实现**：
   - **添加待办事项**：通过输入框添加新的待办事项
   - **标记完成**：点击复选框切换待办事项的完成状态
   - **删除待办事项**：点击删除按钮移除待办事项

3. **拖拽功能实现**：
   - 使用`react-beautiful-dnd`库实现拖拽功能
   - `DragDropContext`：提供拖拽的上下文环境
   - `Droppable`：定义可放置的区域（待办事项列表）
   - `Draggable`：定义可拖动的元素（每个待办事项）
   - `handleDragEnd`：处理拖拽结束后的状态更新

4. **样式设计**：
   - 使用CSS为应用添加样式
   - 为不同状态的待办事项（完成、拖拽中）提供视觉反馈
   - 响应式设计，确保在不同设备上的良好体验

5. **用户体验优化**：
   - 支持回车键添加待办事项
   - 拖拽时提供视觉反馈
   - 显示待办事项完成统计

**扩展功能**：

如果要进一步增强这个应用，可以考虑添加以下功能：

1. **本地存储**：使用`localStorage`保存待办事项，确保页面刷新后数据不丢失

```jsx
// 在组件顶部添加
useEffect(() => {
  const storedTodos = localStorage.getItem('todos');
  if (storedTodos) {
    setTodos(JSON.parse(storedTodos));
  }
}, []);

useEffect(() => {
  localStorage.setItem('todos', JSON.stringify(todos));
}, [todos]);
```

2. **分类功能**：添加不同类别的待办事项，并支持在类别之间拖拽

3. **截止日期**：为待办事项添加截止日期，并根据日期进行排序或提醒

4. **搜索和筛选**：添加搜索框和筛选选项，方便用户查找特定的待办事项

5. **主题切换**：支持明暗主题切换，提升用户体验

6. **撤销/重做**：实现撤销和重做功能，允许用户恢复误操作

**性能优化考虑**：

1. **列表渲染优化**：
   - 对于大量待办事项，考虑使用虚拟列表（如`react-window`）
   - 使用`React.memo`避免不必要的重新渲染

2. **拖拽性能**：
   - 在拖拽过程中，可以使用简化的DOM结构
   - 考虑使用CSS transforms而非直接操作DOM位置

3. **状态管理**：
   - 对于复杂应用，考虑使用Context API或Redux进行状态管理
   - 使用不可变数据结构确保状态更新的高效性

**总结**：

这个待办事项应用展示了React组件设计、状态管理、事件处理和第三方库集成的能力。通过实现拖拽功能，增强了用户交互体验。应用的设计考虑了可维护性、可扩展性和性能优化，是一个功能完整的React实战案例。
